<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>视频流智能分析系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/main.css" rel="stylesheet">
</head>
<body>
    <!-- 背景装饰 -->
    <div class="bg-decoration">
        <div class="decoration-circle decoration-circle-1"></div>
        <div class="decoration-circle decoration-circle-2"></div>
        <div class="decoration-circle decoration-circle-3"></div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-camera-video me-2"></i> 
                <span class="brand-text">视频流智能分析系统</span>
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text status-display" id="systemStatus">
                    <div class="status-indicator status-running me-2"></div>
                    <span class="status-text">系统正常</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- 系统状态卡片 -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card stats-card">
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <div class="stat-icon">
                                        <i class="bi bi-collection-play"></i>
                                    </div>
                                    <h5 class="stat-number text-primary" id="totalStreams">0</h5>
                                    <small class="stat-label">总视频流</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <div class="stat-icon">
                                        <i class="bi bi-play-circle-fill"></i>
                                    </div>
                                    <h5 class="stat-number text-success" id="activeStreams">0</h5>
                                    <small class="stat-label">活跃流</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <div class="stat-icon">
                                        <i class="bi bi-eye-fill"></i>
                                    </div>
                                    <h5 class="stat-number text-info" id="totalDetections">0</h5>
                                    <small class="stat-label">总检测数</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-item">
                                    <div class="stat-icon">
                                        <i class="bi bi-speedometer2"></i>
                                    </div>
                                    <h5 class="stat-number text-warning" id="avgProcessTime">0ms</h5>
                                    <small class="stat-label">平均处理时间</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 主要功能区域 -->
        <div class="row">
            <!-- 左侧：配置面板 -->
            <div class="col-md-4">
                <!-- CSV导入 -->
                <div class="card config-card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-upload me-2"></i> 导入视频流配置
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="upload-area mb-3" id="uploadArea">
                            <div class="upload-content">
                                <i class="bi bi-cloud-upload upload-icon"></i>
                                <div class="upload-text">
                                    <div class="primary-text">拖放CSV文件到这里</div>
                                    <div class="secondary-text">或点击选择文件</div>
                                </div>
                            </div>
                            <input type="file" class="upload-input" id="csvFile" accept=".csv">
                        </div>
                        <button type="button" class="btn btn-primary w-100 upload-btn" onclick="uploadCSV()">
                            <i class="bi bi-upload me-2"></i> 导入配置
                        </button>
                    </div>
                </div>

                <!-- 抽帧规则配置 -->
                <div class="card config-card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-gear-fill me-2"></i> 抽帧规则配置
                        </h6>
                    </div>
                    <div class="card-body">
                        <!-- 配置说明 -->
                        <div class="alert alert-info" role="alert">
                            <i class="bi bi-info-circle me-2"></i> 
                            <strong>智能抽帧：</strong>为每个风险等级单独设置抽帧间隔，系统将根据视频流的风险等级应用对应的配置
                        </div>
                        
                        <!-- 风险等级独立配置 -->
                        <div class="mb-4">
                            <label class="form-label config-label">
                                <i class="bi bi-sliders me-2"></i> 风险等级抽帧间隔配置
                            </label>
                            
                            <!-- 高风险配置 -->
                            <div class="risk-config-item high-risk mb-3">
                                <div class="risk-header">
                                    <span class="badge risk-badge bg-danger">
                                        <i class="bi bi-exclamation-triangle-fill me-1"></i>高风险
                                    </span>
                                    <small class="risk-description">高频检测，实时监控</small>
                                </div>
                                <div class="interval-input">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="highRiskInterval" value="0.5" step="0.1" min="0.1" max="5.0">
                                        <span class="input-group-text">秒</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 中风险配置 -->
                            <div class="risk-config-item medium-risk mb-3">
                                <div class="risk-header">
                                    <span class="badge risk-badge bg-warning">
                                        <i class="bi bi-exclamation-diamond-fill me-1"></i>中风险
                                    </span>
                                    <small class="risk-description">标准检测频率</small>
                                </div>
                                <div class="interval-input">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="mediumRiskInterval" value="1.0" step="0.1" min="0.1" max="5.0">
                                        <span class="input-group-text">秒</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 低风险配置 -->
                            <div class="risk-config-item low-risk mb-3">
                                <div class="risk-header">
                                    <span class="badge risk-badge bg-success">
                                        <i class="bi bi-check-circle-fill me-1"></i>低风险
                                    </span>
                                    <small class="risk-description">低频检测，节省资源</small>
                                </div>
                                <div class="interval-input">
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="lowRiskInterval" value="2.0" step="0.1" min="0.1" max="5.0">
                                        <span class="input-group-text">秒</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 快速预设已移除，仅保留自定义输入框 -->
                        
                        <button type="button" class="btn btn-success w-100 save-config-btn" onclick="saveFrameConfig()">
                            <i class="bi bi-check2-circle me-2"></i> 保存配置
                        </button>
                    </div>
                </div>

                <!-- 全局控制 -->
                <div class="card control-card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-lightning-charge-fill me-2"></i> 全局控制
                        </h6>
                    </div>
                    <div class="card-body">
                        <button type="button" class="btn btn-success w-100 mb-2 control-btn" onclick="startAllStreams()">
                            <i class="bi bi-play-fill me-2"></i> 启动所有流
                        </button>
                        <button type="button" class="btn btn-danger w-100 mb-2 control-btn" onclick="stopAllStreams()">
                            <i class="bi bi-stop-fill me-2"></i> 停止所有流
                        </button>
                        <button type="button" class="btn btn-warning w-100 control-btn" onclick="refreshStreams()">
                            <i class="bi bi-arrow-clockwise me-2"></i> 刷新状态
                        </button>
                    </div>
                </div>
            </div>

            <!-- 右侧：视频流列表和结果 -->
            <div class="col-md-8">
                <!-- 视频流列表 -->
                <div class="card streams-card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            <i class="bi bi-list-ul me-2"></i> 视频流列表
                        </h6>
                        <button class="btn btn-sm btn-outline-primary refresh-btn" onclick="refreshStreams()">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table streams-table mb-0">
                                <thead>
                                    <tr>
                                        <th><i class="bi bi-tag me-1"></i>名称</th>
                                        <th><i class="bi bi-link-45deg me-1"></i>视频源</th>
                                        <th><i class="bi bi-shield me-1"></i>风险等级</th>
                                        <th><i class="bi bi-activity me-1"></i>状态</th>
                                        <th><i class="bi bi-gear me-1"></i>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="streamsList">
                                    <tr class="empty-state">
                                        <td colspan="5" class="text-center">
                                            <div class="empty-content">
                                                <i class="bi bi-inbox empty-icon"></i>
                                                <div class="empty-text">暂无视频流配置</div>
                                                <small class="empty-subtext">请导入CSV文件开始使用</small>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- 实时结果展示 -->
                <div class="card results-card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="bi bi-eye-fill me-2"></i> 实时检测结果
                            <span class="live-indicator">
                                <span class="live-dot"></span>
                                <span class="live-text">LIVE</span>
                            </span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <div id="resultsContainer" class="results-grid">
                            <div class="empty-results">
                                <i class="bi bi-search empty-icon"></i>
                                <div class="empty-text">等待检测结果</div>
                                <small class="empty-subtext">启动视频流后，检测结果将在此显示</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 日志模态框 -->
    <div class="modal fade" id="logModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-journal-text me-2"></i>系统日志
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="logContent" class="log-container">
                        <!-- 日志内容 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast 通知容器 -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer"></div>

    <!-- 加载遮罩 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="loading-text">处理中...</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html> 